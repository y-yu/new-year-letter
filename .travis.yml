dist: bionic
language: generic
sudo: required
env:
  global:
    - IMAGE_NAME=yyupw/letter-pdf
    - REGISTRY_USER=yyupw
    - DOCKER_COMPOSE_VERSION=1.25.0
    - secure: "BSYCcJy0w5dIwpN3qNjdHtg6pCnFnG39Q1weznFp6nMs4amzZNLhrRWlX19qQIYo58lD9LI8bHh/PaemuBJ161U1BQAorbyoxBfcWl0WOPz5t9b2Q7jdkNBehmTUChQJyKS0YJCFGnbARdXn2wObKn8kgTZ5RMhxSCH0bCIhuvCYi3VskrXhWvZ/ZSZxRqkqhuQMKdAOHnJreP37lwWVrk33oeHAokKfw8MeFM+4vd3vEN2LJdjh+lnDSZWKq0WNMozInc0x+ti42rNUi79XzUDTkBG6HJNQ5NGbEMEsqiUqTdUkRxjTPHBK9oGCcEIezD2w7ybAyZU/OHPklH9C1ROmITyZFp34D61y2obzJGZ+mhfDRDmSNNuZHrUSbK2vmWQxZtV+0AOp90EP8Bfwk8E10w/PjAHFmMd4rMy4/56cFYd2fV7az3DPW/ui7z2mZUBKOQG1B/8f8Wp5gSjcIAY1+xK/qq+cL0pwbfIrP7bvRDbQyqrXdLNcbjmY/BukQ/w813Qdm46yNy+BzczySv97IKArL6sVjDDkXvdPRaXwrs6cYY6P35tWyiogP+Rpmd9WTOY6hsKm9mbmZfhQ7LrR01it/CBwSXUnLKCS9sR5Sx1Ev5RPideEzx5X5nCfpxUN5lVeP6F70njvnIPANseVzcMMs8zmeqco66U+K3c="
    - secure: "zEU99UeJuteXs/mZBSHawMseERmjmDuxIu4sWkTd9qsr+Rzy80svgJoGW/Zk02YuZeEfYDWtPp5an7FHdXp0Ri4Jr18d+W7Pt9vP4MLCiP3BSs0BXaShT2uZArxGuy0r4DUWft6daujMLZ+rTW/1DWvnlvcXJG4y66tSdhcbhKIj7fN83JcFhRPvW0437H2lweF8tc4M5l2chbixO2IdbqtooJrPltf2kiTImJfn6IGdGiz+0JNe5mf0KeuPFgdW8VeFnrJqoQ+R9OnEz9sBGeomdmkXNgyPuN63KJeZGGX0BJh7auWV+99k7vpb4UpjmatDuzXvniZ0voJNjorvkGvmRYVyP8B66tgDcaXQT7OY0sLm317Qy2QsDHrageZWftk/kT0fDBbtuPL5UqdwyD2hMPvG+1V9bvTratgROkfWqMkjksHheW3fD4Fj67OJWGTaPYRXZDUOqCJCNx9sKMXsSc0kvUhCbcjMTLZdsUDMd1BmOSmyqGEMMPjzBslbyej4iZL0v9fvPHX9PX4i+GikjC5YUUe9WLyU6Cyp7785S4CHTKnUkDOvIfpvMHmB3e1vE9dow96rRg9koNsjDLPI70WPENESjXpVuyEbNxiWsRPYYE5CH+aYYH7JXIHh1bAznKu8rDYX5IKjeLB8IrBXGghnL/Qz5C5I+m7hKBk="
services:
  - docker
branches:
  only:
    - master
before_install:
  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
install:
  - docker-compose pull
  - docker-compose build
script:
  - docker-compose up --exit-code-from letter-compile
after_success:
  - ./travis/deploy_image.sh
  - ./travis/deploy_pdf.sh
after_failure:
  - cat letter.log
